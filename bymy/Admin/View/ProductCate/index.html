<?php
 $request = I('get.');
?>
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <title>商品分类信息</title>
    <link rel="stylesheet" href="{$Think.ADMIN_LAYUI_CSS}/layui.css">
    <link rel="stylesheet" href="{$Think.ADMIN_CSS_URL}/global.css">
    <link rel="stylesheet" href="{$Think.ADMIN_CSS_URL}/common.css">
    <link rel="stylesheet" href="{$Think.ADMIN_CSS_URL}/page.css">
    <script type="text/javascript" src="{$Think.const.ADMIN_JQUERY_JS}/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="{$Think.const.ADMIN_LAYUI_JS}/layui.js"></script>
    <script type="text/javascript" src="{$Think.const.ADMIN_LAYDATE_JS}"></script>
    <script type="text/javascript" src="{$Think.const.ADMIN_JS_URL}/common.js"></script>
</head>
<body >
<div class="body-all">
<blockquote class="layui-elem-quote layui-quote-nm">
    <p>商品分类信息</p>
</blockquote>
    <div style="padding: 15px">
        <div class="layui-tab">
            <ul class="layui-tab-title layui-tab-brief">
                <li><a href="__MODULE__/Product/index">商品信息</a></li>
                <li><a href="__MODULE__/Product/add" >添加商品</a></li>
                <li class="layui-this"><a href="__SELF__" >查看商品分类</a></li>
                <li><a href="__CONTROLLER__/add" >添加商品分类</a></li>
            </ul>
            <div class="layui-tab-content">
                <div class="layui-tab-item layui-show">
                    <form class="layui-form" action="__SELF__">
                        <div class="layui-form-item">
                            <div class="layui-form-item">
                                <label class="layui-form-label">搜索序号</label>
                                <div class="layui-input-inline">
                                    <input name="id" placeholder="请输入序号" autocomplete="off"
                                           class="layui-input" type="text" value="<?php if($request['id']) echo $request['id']?>" >
                                </div>
                                <label class="layui-form-label">搜索名称</label>
                                <div class="layui-input-inline">
                                    <input name="name"  placeholder="请输入搜索名称" autocomplete="off" class="layui-input"
                                           type="text"  value="<?php if($request['name']) echo $request['name']?>" >
                                </div>
                                <label class="layui-form-label">选择级别</label>
                                <div class="layui-input-inline">
                                    <select name="level" lay-ignore  class="select-self">
                                        <option value="" <?php if($request['level']=='') echo 'selected'?>>所有</option>
                                        <option value="0" <?php if($request['level']=='0') echo 'selected'?>>顶级</option>
                                        <option value="1" <?php if($request['level']=='1') echo 'selected'?>>级别1</option>
                                        <option value="2" <?php if($request['level']=='2') echo 'selected'?>>级别2</option>
                                    </select>
                                </div>
                            </div>
                            <div class="layui-inline" style="width: 800px">
                                <label class="layui-form-label">时间</label>
                                <div class="layui-input-inline">
                                    <select name="time-type" lay-ignore  class="select-self">
                                        <option value="">所有时间</option>
                                        <option value="add_time">添加时间</option>
                                        <option value="edit_time">修改时间</option>
                                    </select>
                                </div>
                                <div class="layui-input-inline ">
                                    <input type="text" name="price[0]" placeholder="（时间小值）" autocomplete="off" class="layui-input"
                                            value="<?php if($request['time-search'][0]) echo $request['price'][0]?>" id="time-starts">
                                </div>
                                <div class="layui-input-inline" >
                                    <input type="text" name="price[1]" placeholder="（时间大值）" autocomplete="off" class="layui-input"
                                           value="<?php if($request['time-search'][1]) echo $request['price'][1]?>" id="time-end" >
                                </div>
                            </div>
                            <div class="layui-input-block" style="float: right">
                                <button class="layui-btn layui-btn-normal" lay-submit lay-filter="formDemo">查询</button>
                                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                            </div>
                        </div>
                    </form>
                    <div class="layui-form-item">
                        <a class="layui-btn " href="__CONTROLLER__/add"><i class="layui-icon">&#xe608;</i>添加分类</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-form">
            <table class="layui-table" lay-even="" lay-skin="row">
                <colgroup>
                    <col width="150">
                    <col width="200">
                    <col>
                </colgroup>
                <thead>
                <tr >
                    <th style="width: 20px;"><input name="" lay-skin="primary" lay-filter="allChoose" type="checkbox"></th>
                    <th>序号</th>
                    <th>分类名称</th>
                    <th>等级</th>
                    <th>父级</th>
                    <th>创建时间</th>
                    <th>修改时间</th>
                    <th align="center">操作</th>
                </tr>
                </thead>
                <tbody>
                <volist name="data" id="v">
                    <tr >
                        <td><input name="" lay-skin="primary" type="checkbox"></td>
                        <td>{$v.id}</td>
                        <td>{$v.name}</td>
                        <td>{$v.level}</td>
                        <td>{$v.pidname}</td>
                        <td>{$v.add_time|date='Y-m-d h:i:s',###}</td>
                        <td><if condition=" $v['edit_time'] gt 0">{$v.edit_time|date='Y-m-d h:i:s',###}</if></td>
                        <td>
                            <a href="javascript:void(0);" onclick="edit({$v.id},'__CONTROLLER__/edit')">修改</a>
                            <a href="javascript:void(0);" onclick="del({$v.id},'__CONTROLLER__/del')">删除</a>
                        </td>
                    </tr>
                </volist>
                </tbody>
            </table>
            <div>
            <div class="page-container" >
                <include file="Common:page" page="{$page}" />
            </div>
            </div>
        </div>
    </div>
</div>
<!--修改dialog-->
<div id="edit-dialog" style="display: none;">
    <div class="layui-tab-content">
        <div class="layui-tab-item layui-show">
            <div class="layui-form-item">
                <div class="layui-form-item">
                    <label class="layui-form-label">商品名称</label>
                    <div class="layui-input-inline">
                        <input name="name" lay-verify="required" placeholder="请输入商品名称" autocomplete="off"
                               class="layui-input name" value="" type="text">
                    </div>
                    <label class="layui-form-label">选择分类</label>
                    <div class="layui-input-inline">
                        <select name="cate_id" class="cate_id">
                            <option value="">请选择分类</option>
                            <volist name="data" id="v">
                                <option value="{$v.id}">
                                    <if condition="$v['pid'] eq 0">{$v.name}</if>
                                </option>
                            </volist>
                        </select>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">价格</label>
                    <div class="layui-input-inline input-width-small">
                        <input type="text" name="price" placeholder="￥" autocomplete="off"
                               class="layui-input price" value="">
                    </div>
                    <label class="layui-form-label">库存数量</label>
                    <div class="layui-input-inline input-width-small">
                        <input type="text" name="number" placeholder="个" autocomplete="off"
                               class="layui-input number" value="">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">品牌</label>
                    <div class="layui-input-inline input-width-small">
                        <input type="text" name="brand" placeholder="个" autocomplete="off"
                               class="layui-input brand" value="">
                    </div>
                    <div class="layui-input-inline" style="right:-130px">
                        <div class="upload">
                            <img src="" class="image" style="width: 100px;">
                            <input type="file" name="img" class="upload-image"/>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--end修改dialog-->
<script type="text/javascript">

    /**
     * 编辑商品分类
     * @param id
     * @param url
     */
    function edit(id,url) {
        layui.use('layer', function() {
            var layer = layui.layer;
            $.get(url,{id:id},function (data) {
                if(data.status){
                    $('#edit-dialog').find('input.name').    val(data.data.name);
                    $('#edit-dialog').find('input.price').   val(data.data.price);
                    $('#edit-dialog').find('input.number').  val(data.data.number);
                    $('#edit-dialog').find('input.brand').   val(data.data.brand);
                    $('#edit-dialog').find('select.cate_id').val(data.data.cate_id);
                    $('#edit-dialog').find('img.image').     attr('src','/'+data.data.image);
                }else{
                    layer.msg(data.msg);
                }
            },'json');
            layer.open({
                type: 1,
                skin: 'layui-layer-hightlan', //加上边框
                area: ['800px', '440px'], //宽高
                btn: ['确定', '取消'],
                content: $('#edit-dialog'),
                yes: function (index, layero) {

                    var img ;
                    alert($('#edit-dialog').find('input.upload-image').val());

                    $.post(url,{
                        name:   $('#edit-dialog').find('input.name').    val(),
                        price:  $('#edit-dialog').find('input.price').   val(),
                        number: $('#edit-dialog').find('input.number').  val(),
                        brand:  $('#edit-dialog').find('input.brand').   val(),
                        cate_id:$('#edit-dialog').find('select.cate_id').val(),
                        img:$('#edit-dialog').find('img.image').attr('src')
                    },function(data) {
                        
                    });
                }
            });
        });
    }

    /*----------------------------日期选择器--------------------------------------*/
//    layui.use(['laydate'],function () {
    laydate.skin('shenlan');
    var start = {
        elem: '#time-starts',
        skin: '#34A8FF',
        max: laydate.now(),
        festival: true,
        istoday: true,
        choose: function (datas) {
            end.min = datas; //开始日选好后，重置结束日的最小日期
            end.start = datas //将结束日的初始值设定为开始日
        }
    };
    laydate(start);
    var end = {
        elem: '#time-end',
        max: '2099-06-16 23:59:59',
        festival: true,
        istoday: true,
        choose: function (datas) {
            start.max = datas; //结束日选好后，重置开始日的最大日期
        }
        };
    laydate(end);

//    });
    /*-------------------end 日期选择器-------------------------------*/
</script>


</body>
</html>